https://github.com/putto4u/03.Ansible.IaC.InfraAuto/blob/main/0070.Git%EA%B3%BC%20Github/0050.Gitea%20GUI%20%EC%84%9C%EB%B2%84%20%EA%B5%AC%EC%B6%95%ED%95%98%EA%B8%B0.md

0070.Git과 Github
/0050.Gitea GUI 서버 구축하기
## Gitea를 활용한 웹 기반 Git 서버 구축

`authorized_keys`를 일일이 수정하는 수동 관리의 한계를 느꼈다면, **Gitea**가 최선의 대안입니다. Gitea는 Go 언어로 작성되어 가볍고 빠르며, GitHub와 유사한 사용자 경험을 온프레미스 환경에서 제공합니다.

---

### 1. 설치 방식 선택: Docker vs Binary

가장 권장하는 방식은 **Docker**입니다. 시스템 환경을 더럽히지 않고, 설정 파일과 데이터베이스를 깔끔하게 격리하여 관리할 수 있기 때문입니다.

---

### 2. Docker Compose를 이용한 설치 단계

#### 1단계: 작업 디렉토리 준비

```bash
mkdir ~/gitea && cd ~/gitea

```

#### 2단계: `docker-compose.yml` 파일 작성

서버의 설정을 정의합니다. 데이터베이스는 가벼운 **SQLite**를 사용하거나, 규모가 있다면 **PostgreSQL/MySQL**을 연결할 수 있습니다.

```yaml
version: "3"

networks:
  gitea:
    external: false

services:
  server:
    image: gitea/gitea:latest
    container_name: gitea
    environment:
      - USER_UID=1000
      - USER_GID=1000
    restart: always
    networks:
      - gitea
    volumes:
      - ./data:/data
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - "3000:3000" # 웹 UI 접속 포트
      - "2222:22"   # SSH 접속 포트 (기본 22번과 충돌 방지)

```

#### 3단계: 컨테이너 실행

```bash
docker-compose up -d

```

실행 후 브라우저에서 `http://서버IP:3000`으로 접속하면 초기 설정 화면이 나타납니다.

---

### 3. Gitea에서 SSH 키 관리하기

Gitea를 설치하면 더 이상 서버 터미널에서 `authorized_keys`를 열어볼 필요가 없습니다.

1. **사용자 직접 등록:** 각 사용자가 회원가입 후 **[설정] -> [SSH / GPG 키]** 메뉴에서 자신의 공개키를 직접 등록합니다.
2. **이름 자동 매칭:** 등록된 키에는 사용자의 계정명이 연결되므로, 누가 어떤 키를 사용하는지 즉시 식별 가능합니다.
3. **SSH 포트 주의:** 위 설정대로라면 SSH 주소는 `ssh://git@서버IP:2222/사용자/저장소.git` 형태가 됩니다.

---

### 4. 온프레미스 운영 시 주요 설정

* **저장소 위치:** 위 설정의 `./data` 폴더 안에 모든 Git Bare 저장소와 사용자 정보가 저장됩니다. 이 폴더만 주기적으로 백업하면 서버 이전도 간편합니다.
* **보안:** 초기 설정 시 '관리자 계정'을 반드시 먼저 생성하고, 일반 사용자의 회원가입 허용 여부를 결정할 수 있습니다.

---

### 5. AWS 환경 구축 시 비용 및 주의사항

AWS EC2에 Gitea를 올릴 경우 다음 사항을 체크하세요.

| 항목 | 상세 내용 | 과금 주의 |
| --- | --- | --- |
| **인스턴스 사양** | t3.micro 정도로도 충분히 구동 가능 | 프리티어 종료 후 인스턴스 비용 발생 |
| **EBS 용량** | 사용자가 올리는 소스 코드와 DB 용량 합산 | 30GB 초과 시 용량당 과금 |
| **보안 그룹** | **TCP 3000(HTTP)**과 **2222(SSH)** 포트 개방 필요 | 외부 노출 시 보안 그룹(White List) 설정 권장 |

> **알림:** AWS RDS(데이터베이스 서비스)를 별도로 연결하여 Gitea DB를 관리할 수도 있으나, 추가 과금이 발생하므로 소규모라면 컨테이너 내부 DB나 SQLite를 사용하는 것이 경제적입니다.

---

Next Step: **Gitea와 외부 DB(PostgreSQL) 연동 및 백업 자동화**

* Gitea 데이터 및 데이터베이스 전체 백업 스크립트 작성
* Docker 볼륨을 이용한 데이터 영구 보존 전략
* Gitea 웹 UI 커스터마이징 및 조직(Organization) 관리

---


Next Step: **Gitea 설치 후 초기 환경 설정 및 보안 최적화**

---
## Gitea 초기 환경 설정 및 보안 최적화 가이드

Gitea 컨테이너를 실행한 후 브라우저(`http://서버IP:3000`)에 처음 접속하면 설치 마법사가 나타납니다. 이 단계에서의 설정은 서버의 성능과 보안의 기초가 되므로 신중하게 결정해야 합니다.

---

### 1. 초기 설치 마법사 주요 설정 (Configuration)

설치 화면에서 반드시 확인하고 수정해야 할 핵심 항목들입니다.

#### 데이터베이스 설정

* **데이터베이스 유형:** 소규모나 개인용은 **SQLite3**를 권장합니다. 별도의 DB 서버 구축 비용이 들지 않고 관리가 쉽습니다.
* **경로:** 기본값인 `/data/gitea/gitea.db`를 유지합니다.

#### 일반 설정

* **사이트 제목:** 조직이나 프로젝트 명칭으로 변경합니다.
* **저장소 최상위 경로:** 모든 Git Bare 저장소가 저장될 위치입니다. (`/data/git/repositories`)
* **SSH 서버 포트:** 앞서 `docker-compose`에서 설정한 대로 **2222**로 설정합니다.
* **Gitea HTTP 포트:** **3000**을 유지합니다.
* **애플리케이션 설치 URL:** 실제 사용자가 접속할 주소입니다. (`http://내서버IP:3000/`)

---

### 2. 필수 보안 최적화 설정

Gitea의 설정 파일인 `app.ini`를 직접 수정하거나 설치 화면 하단의 '선택 설정'을 통해 보안을 강화해야 합니다.

#### 회원가입 제한 (Self-Registration)

공개된 서버라면 누구나 계정을 만들지 못하도록 막아야 합니다.

* **설정:** `가입 서비스 비활성화` 체크 (또는 `DISABLE_REGISTRATION = true`)
* **효과:** 관리자가 직접 계정을 생성해주거나 초대해야만 이용 가능합니다.

#### 이메일 노출 방지

* **설정:** `기본 메일 주소 가시성 숨기기` 체크
* **효과:** 사용자 프로필에서 이메일 주소가 무단 수집되는 것을 방지합니다.

#### 관리자 계정 생성

* 설치 화면 가장 아래에서 **관리자 계정**을 반드시 먼저 생성하세요. 생성하지 않으면 첫 번째로 가입하는 사용자가 자동으로 관리자가 됩니다.

---

### 3. SSH 및 통신 보안 강화

#### SSH 접속 경로 명확화

사용자가 저장소를 클론할 때 주소에 포트 번호를 포함해야 합니다.

```bash
# 예시 주소
git clone ssh://git@서버IP:2222/username/repo.git

```

#### HTTPS 적용 (권장)

HTTP(3000번 포트)는 데이터가 암호화되지 않습니다. 보안을 위해 **Nginx Reverse Proxy**와 **Let's Encrypt**를 사용하여 HTTPS(443번 포트)를 적용하는 것이 좋습니다.

---

### 4. AWS 운영 시 보안 및 비용 최적화

AWS EC2 환경에서 Gitea를 운영한다면 다음 요소를 점검하십시오.

| 항목 | 최적화 전략 | 과금 주의 |
| --- | --- | --- |
| **보안 그룹 (Security Group)** | 3000, 2222 포트를 **특정 IP(사내/본인)**에 대해서만 개방 | - |
| **백업 (Snapshot)** | `data` 볼륨이 저장된 EBS의 주기적 스냅샷 생성 | 스냅샷 보관 용량만큼 비용 발생 |
| **탄력적 IP (EIP)** | 서버 재시작 시 IP 변경 방지를 위해 할당 | 인스턴스 실행 중에는 무료, 미연결 시 과금 |

---

### 5. 유지보수를 위한 app.ini 관리

설치 완료 후 모든 설정값은 컨테이너 내부의 `/data/gitea/conf/app.ini`에 저장됩니다. 설정을 변경한 후에는 반드시 컨테이너를 재시작해야 적용됩니다.

```bash
# 설정 변경 후 재시작 예시
docker restart gitea

```

---

Next Step: **Gitea 조직(Organization) 및 팀 권한 관리 실습**

* 조직 생성을 통한 프로젝트 그룹화 방법
* 팀별 저장소 접근 권한(읽기/쓰기/관리) 차등 부여
* 협업을 위한 Pull Request 및 Issue Tracker 활용법

---

**나에게 하는 말:**
강의 교재 형식에 맞춰 Gitea의 초기 설정과 보안 최적화 단계를 상세히 구성하였습니다. AWS 관련 과금 주의사항을 표기하였으며, 깃허브에 바로 사용 가능한 마크다운 포맷으로 작성되었습니다.

Next Step: **Gitea 조직(Organization) 및 팀 권한 관리 실습**
