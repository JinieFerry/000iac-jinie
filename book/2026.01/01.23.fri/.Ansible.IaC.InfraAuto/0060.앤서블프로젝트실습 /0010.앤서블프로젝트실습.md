https://github.com/putto4u/03.Ansible.IaC.InfraAuto/blob/main/0060.%EC%95%A4%EC%84%9C%EB%B8%94%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%8B%A4%EC%8A%B5/0010.%EC%95%A4%EC%84%9C%EB%B8%94%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%8B%A4%EC%8A%B5.md

# ì•¤ì„œë¸” ì‹¤ì „ í”„ë¡œì íŠ¸: ì˜¨í”„ë ˆë¯¸ìŠ¤ í™˜ê²½ì„ ìœ„í•œ ë³´ì•ˆ ì›¹/DB êµ¬ì¶•

ë³¸ í”„ë¡œì íŠ¸ëŠ” AWSì™€ ê°™ì€ í´ë¼ìš°ë“œ ë°©í™”ë²½ì— ì˜ì¡´í•˜ì§€ ì•Šê³ , **ì„œë²„ ìì²´ì˜ ì„¤ì •ë§Œìœ¼ë¡œ ë³´ì•ˆì„ ê°•í™”**í•˜ëŠ” êµ¬ì„±ì„ ë‹¤ë£¹ë‹ˆë‹¤.

* **ì›¹ ì„œë²„ (Nginx):** 8080ë²ˆ í¬íŠ¸ë¥¼ í†µí•´ **ëˆ„êµ¬ë‚˜ ì™¸ë¶€ì—ì„œ ì ‘ì† ê°€ëŠ¥**í•©ë‹ˆë‹¤.
* **ë°ì´í„°ë² ì´ìŠ¤ (MariaDB):** ì² ì €í•˜ê²Œ **ë‚´ë¶€(Localhost)**ì—ì„œë§Œ ì ‘ì†ì„ í—ˆìš©í•©ë‹ˆë‹¤.
* **Nginx (PHP):** ê°™ì€ ì„œë²„ ë‚´ë¶€ì˜ ë¡œì»¬ í†µì‹ ìœ¼ë¡œ DBì— ì ‘ì†í•©ë‹ˆë‹¤.
* **Admin:** ì„œë²„ ë¡œì»¬ í„°ë¯¸ë„(SSH)ì„ í†µí•´ì„œë§Œ ê´€ë¦¬ ê¶Œí•œì„ í–‰ì‚¬í•©ë‹ˆë‹¤. (ì™¸ë¶€ ì§ì ‘ ì ‘ì† ì°¨ë‹¨)



---

### 1. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° (Directory Structure)

ì•¤ì„œë¸”ì´ ê·œì¹™ì„ ë§Œë“¤ì—ˆìŒ
```text
ansible-project/ # ì´ í”„ë¡œì íŠ¸ì˜ í™ˆë””ë ‰í† ë¦¬
â”œâ”€â”€ group_vars/
â”‚   â””â”€â”€ all/
â”‚       â””â”€â”€ vault.yml        # [ë³´ì•ˆ] ì•”í˜¸í™”ëœ ë¹„ë°€ë²ˆí˜¸ ì €ì¥ì†Œ #ë””ë ‰í† ë¦¬ ì•„ë‹ˆê³  íŒŒì¼
â”œâ”€â”€ roles/
â”‚   â”œâ”€â”€ common/              # [Role] íŒ¨í‚¤ì§€ ìºì‹œ ì—…ë°ì´íŠ¸ ë° ê¸°ë³¸ ìœ í‹¸ #roles ë””ë ‰í† ë¦¬ /ë°‘ìœ¼ë¡œ tasksìˆìŒ
â”‚   â”œâ”€â”€ mariadb/             # [Role] DB ì„¤ì¹˜, ë¡œì»¬ ë³´ì•ˆ ì„¤ì •, ë°ì´í„° ì£¼ì…
â”‚   â”œâ”€â”€ nginx/               # [Role] ì›¹ì„œë²„ ì„¤ì¹˜, 8080 í¬íŠ¸ ê°œë°©, PHP ì—°ë™
â”‚   â””â”€â”€ webapp/              # [Role] PHP ì†ŒìŠ¤ ë°°í¬ (DB ì—°ë™ í˜ì´ì§€)
â”œâ”€â”€ inventory.ini            # ê´€ë¦¬ ëŒ€ìƒ ì„œë²„ ëª©ë¡ (IP ì£¼ì†Œ: hostname/macì£¼ì†Œ,ê·¸ë£¹ë§Œë“¤ê¸°ë„ í•  ìˆ˜ ìˆìŒ ) 
â”œâ”€â”€ site.yml                 # ì „ì²´ í”Œë ˆì´ë¶ ì‹¤í–‰ íŒŒì¼ (index.htmlì²˜ëŸ¼ ì œì¼ ë¨¼ì € ì‹¤í–‰ë˜ì§€ë§Œ, ansible-playbookì—ì„œ ë¶ˆëŸ¬ì„œ ê·¸ëŸ¼ ì •í•´ì§„ ê±´ ì•„ë‹˜)
â””â”€â”€ setup.yml                # (ìµœì´ˆ 1íšŒìš©) ë””ë ‰í† ë¦¬/íŒŒì¼ ìë™ ìƒì„± ìŠ¤í¬ë¦½íŠ¸ #setupì€ ë””ë ‰í† ë¦¬ ì•ˆì— ë“¤ì–´ê°€ëŠ” ê±´ ì•„ë‹ˆê³  ymlì„ í”„ë¡œê·¸ë¨ì²˜ëŸ¼ ì“¸ ìˆ˜ ìˆëŠ” ê±¸ ë³´ì—¬ì£¼ë ¤ê³  ì›ì„±ë‘ íŒ€ì¥ë‹˜ì´ ì§  íŠ¸ë¦¬(ì‹¤ë¬´ì—ì„œë„ ì´ë ‡ê²Œ ì§¬)

```

---

### 2. [Step 0] ë””ë ‰í† ë¦¬ ë° íŒŒì¼ ìë™ ìƒì„± (setup.yml)

ìˆ˜ë™ ìƒì„±ì„ ë°©ì§€í•˜ê¸° ìœ„í•œ ìŠ¤ìºí´ë”©(Scaffolding) í”Œë ˆì´ë¶ì…ë‹ˆë‹¤.

**`setup.yml`**
#yamlì€ ì–´ëŠ í˜¸ìŠ¤íŠ¸ì˜ ì–´ëŠ tasksë¥¼ í•˜ëŠ” ê²ƒì¸ì§€ í•­ìƒ ì£¼ì„ì„ ì¨ë†”ì•¼ í•¨ íšŒì‚¬ì—ì„œë„ ì‹œí‚´
#tasksê°€ ë§ì•„ì§€ë©´roleë¡œ ë¬¶ìŒ
```yaml
# ì‹¤í–‰: ansible-playbook setup.yml
- name: í”„ë¡œì íŠ¸ ê¸°ì´ˆ êµ¬ì¡° ìƒì„±
  hosts: localhost
  connection: local
  gather_facts: no
  tasks:
    - name: ë¡¤(Role) ë° ë³€ìˆ˜ ë””ë ‰í† ë¦¬ ìƒì„±
      file: # ë””ë ‰í† ë¦¬ ê´€ë ¨ ëœ ê±°ì•¼~
        path: "{{ item }}" #pathëŠ” ê²½ë¡œ itemì€ ë‚´ë¶€ì ìœ¼ë¡œ ì“°ëŠ” ì˜ˆì•½ì–´=ì–´ë””ì„œ ì„ ì–¸í•˜ì§€ ì•ŠìŒ ë³´í†µ loop ë¶ˆëŸ¬ì˜¬ ë•Œ ë§ì´ ì”€
        state: directory # state:ìƒíƒœ = í•  ë ¤ê³  í•˜ëŠ” ì‘ì—…ì´ ìœ ì§€ë˜ì–´ì•¼ í•˜ëŠ” ìƒíƒœ "ë‹ˆê°€ í•˜ëŠ” ì‘ì—…ì´ ì´ëŸ° ìƒíƒœë¡œ ìˆì–´ì•¼ í•´~" ì´ê²Œ ìš°ë¦¬ ëª©í‘œì•¼!
      loop: #íŒŒì´ì¬ì€ ì§ê´€ì ìœ¼ë¡œ ë§Œë“¤ê¸° ë•Œë¬¸ì— íŒŒì¼ ë¯¸ë¦¬ ì§€ì •í•˜ê³  ìˆì§€ì•Šë‹¤ê°€, ë°ì´í„° ì…ë ¥í•˜ë©´ ì§€ì •í•¨
        - group_vars/all 
        - roles/common/tasks
        - roles/mariadb/tasks
        - roles/mariadb/templates
        - roles/nginx/tasks
        - roles/nginx/templates
        - roles/webapp/tasks
        - roles/webapp/templates

    - name: ë¹ˆ íŒŒì¼ ìƒì„± (ì´í›„ ë‚´ìš©ì„ ì±„ì›Œë„£ìŒ)
      file: #ëª¨ë“ˆ
        path: "{{ item }}"
        state: touch #ì²˜ìŒ ë§Œë“¤ì–´ë‘” ìƒíƒœ
      loop:
        - inventory.ini
        - site.yml
        - group_vars/all/vault.yml
        - roles/common/tasks/main.yml
        - roles/mariadb/tasks/main.yml
        - roles/nginx/tasks/main.yml
        - roles/nginx/templates/default.j2 #jinja2ì–¸ì–´(ì¢€ ì´ìƒí•¨)
        - roles/webapp/tasks/main.yml
        - roles/webapp/templates/index.php.j2

```

**[ì‹¤í–‰ ëª…ë ¹ì–´] ë°˜ë“œì‹œ ì•„ë˜ ëª…ë ¹ì–´ë¡œ êµ¬ì¡°ë¥¼ ë¨¼ì € ìƒì„±í•˜ì„¸ìš”.**

```bash
ansible-playbook setup.yml

```

---

### 3. [Step 1] ë¹„ë°€ë²ˆí˜¸ ì•”í˜¸í™” (Ansible Vault)

ë³´ì•ˆì„ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ëŠ” í‰ë¬¸ìœ¼ë¡œ ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

1. **Vault íŒŒì¼ :** `ansible-vault encrypt group_vars/all/vault.yml`
2. `ansible-vault edit group_vars/all/vault.yml`
3. **ë‚´ìš© ì…ë ¥:**

```yaml
# DB ë£¨íŠ¸(Superuser) ë¹„ë°€ë²ˆí˜¸
db_root_password: "StrongRootPassword!@#"

# ë¡œì»¬ ê´€ë¦¬ì(Admin) ë¹„ë°€ë²ˆí˜¸
db_admin_password: "StrongAdminPassword!@#"

# ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜(Webapp) ì „ìš© ë¹„ë°€ë²ˆí˜¸
db_web_password: "StrongWebPassword!@#"

```

---

### 4. [Step 2] ì—­í• (Role)ë³„ ìƒì„¸ êµ¬í˜„

#### (1) Common Role

**`roles/common/tasks/main.yml`**

```yaml
# ëª¨ë“  ì„œë²„ì— ê³µí†µ ì ìš©ë˜ëŠ” ê¸°ì´ˆ ì‘ì—…
- name: APT ìºì‹œ ì—…ë°ì´íŠ¸ (íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì—ëŸ¬ ë°©ì§€)
  apt:
    update_cache: yes
    cache_valid_time: 3600

```

#### (2) MariaDB Role (í•µì‹¬: ë¡œì»¬ ì „ìš© ë³´ì•ˆ ì„¤ì •)

ì™¸ë¶€ ì ‘ì†ì„ ì›ì²œ ì°¨ë‹¨í•˜ê³  ì˜¤ì§ `localhost` ì ‘ì†ë§Œ í—ˆìš©í•©ë‹ˆë‹¤.

**`roles/mariadb/tasks/main.yml`**

```yaml
- name: MariaDB ë° Python ë°”ì¸ë”© ì„¤ì¹˜
  apt:
    name:
      - mariadb-server
      - python3-pymysql # Ansibleì´ MySQLì„ ì œì–´í•˜ê¸° ìœ„í•œ í•„ìˆ˜ ëª¨ë“ˆ
    state: present

# [ì¤‘ìš”] ì™¸ë¶€ ì ‘ì† ì°¨ë‹¨ ì„¤ì •
# 127.0.0.1ë¡œ ì„¤ì •í•˜ë©´ ëœì„ (ì™¸ë¶€ IP)ì„ í†µí•œ ì ‘ì† ìš”ì²­ì„ ì•„ì˜ˆ ë“£ì§€ ì•ŠìŠµë‹ˆë‹¤.
- name: ë¡œì»¬ ì ‘ì†ë§Œ í—ˆìš© (bind-address = 127.0.0.1)
  lineinfile:
    path: /etc/mysql/mariadb.conf.d/50-server.cnf
    regexp: '^bind-address'
    line: 'bind-address = 127.0.0.1'
  notify: restart mariadb

- name: MariaDB ì„œë¹„ìŠ¤ ì‹œì‘ ë° í™œì„±í™”
  service:
    name: mariadb
    state: started
    enabled: yes

- name: ë°±ì—… ë””ë ‰í† ë¦¬ ìƒì„±
  file:
    path: /var/lib/mysql/backup
    state: directory
    owner: mysql
    group: mysql
    mode: '0755'

- name: ë¡œì»¬ì˜ employees.sql íŒŒì¼ ì„œë²„ë¡œ ë³µì‚¬
  copy:
    src: ~/dbbackup/employees.sql # ì•¤ì„œë¸” ì‹¤í–‰ PCì˜ ê²½ë¡œ
    dest: /var/lib/mysql/backup/employees.sql
    owner: mysql
    group: mysql

# become: yesê°€ ì—†ìœ¼ë©´ Root ê¶Œí•œì´ ì—†ì–´ DB Importê°€ ì‹¤íŒ¨í•©ë‹ˆë‹¤.
- name: ë°ì´í„°ë² ì´ìŠ¤ ì£¼ì… (Import)
  community.mysql.mysql_db:
    name: employees
    state: import
    target: /var/lib/mysql/backup/employees.sql
    login_unix_socket: /var/run/mysqld/mysqld.sock


# [ë³´ì•ˆ] ê´€ë¦¬ìë„ ì˜¤ì§ ë¡œì»¬(í„°ë¯¸ë„)ì—ì„œë§Œ ì ‘ì† ê°€ëŠ¥
- name: ë¡œì»¬ ê´€ë¦¬ì(Admin) ê³„ì • ìƒì„±
  community.mysql.mysql_user:
    name: dbadmin
    password: "{{ db_admin_password }}"
    priv: '*.*:ALL,GRANT' # ëª¨ë“  ê¶Œí•œ ë¶€ì—¬
    host: 'localhost'      # [ì¤‘ìš”] ì™¸ë¶€ ì ‘ì† ë¶ˆê°€, ë¡œì»¬ ì „ìš©
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock

# [ë³´ì•ˆ] ì›¹ì•±ì€ ë¡œì»¬í˜¸ìŠ¤íŠ¸ë¥¼ í†µí•´ DB ì ‘ì†
- name: ì›¹(Web) ê³„ì • ìƒì„±
  community.mysql.mysql_user:
    name: webuser
    password: "{{ db_web_password }}"
    priv: 'employees.*:SELECT' # employees DBë§Œ ì¡°íšŒ ê°€ëŠ¥ (ìµœì†Œ ê¶Œí•œ)
    host: 'localhost'
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock

handlers:
  - name: restart mariadb
    service:
      name: mariadb
      state: restarted

```

#### (3) Nginx Role (í•µì‹¬: 8080 í¬íŠ¸ ê°œë°©)

ì›¹ ì„œë²„ëŠ” ì™¸ë¶€ì— ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•´ì•¼ í•˜ë¯€ë¡œ 8080 í¬íŠ¸ë¥¼ ì—´ì–´ë‘¡ë‹ˆë‹¤.

**`roles/nginx/tasks/main.yml`**

```yaml
- name: Nginx ì„¤ì¹˜
  apt:
    name: nginx
    state: present

# AWSê°€ ì•„ë‹ˆë¯€ë¡œ OS ë°©í™”ë²½(UFW)ì—ì„œ í¬íŠ¸ë¥¼ ì—´ì–´ì•¼ í•©ë‹ˆë‹¤.
- name: ë°©í™”ë²½(UFW) - 8080 í¬íŠ¸ ì™¸ë¶€ ì ‘ì† í—ˆìš©
  community.general.ufw:
    rule: allow
    port: '8080'
    proto: tcp

- name: Nginx ì„¤ì • íŒŒì¼ ë°°í¬
  template:
    src: default.j2
    dest: /etc/nginx/sites-available/default
  notify: restart nginx

handlers:
  - name: restart nginx
    service:
      name: nginx
      state: restarted

```

**`roles/nginx/templates/default.j2`**

```nginx
server {
    # [ì¤‘ìš”] 8080 í¬íŠ¸ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ìš”ì²­ì„ ìˆ˜ì‹ 
    listen 8080 default_server;
    server_name _;
    
    # ì›¹ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ ì„¤ì •
    root /var/www/html;
    index index.php index.html;

    location / {
        try_files $uri $uri/ =404;
    }

    # PHP-FPM ì—°ë™ (Local Socket ë°©ì‹)
    # Nginxì™€ PHPëŠ” ê°™ì€ ì„œë²„ ë‚´ì—ì„œ ì†Œì¼“ íŒŒì¼ë¡œ í†µì‹ í•©ë‹ˆë‹¤.
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        # Ubuntu 24.04ì˜ ê¸°ë³¸ PHP ë²„ì „(8.3) ì†Œì¼“ ê²½ë¡œ í™•ì¸ í•„ìš”
        fastcgi_pass unix:/run/php/php8.3-fpm.sock;
    }
}

```

#### (4) WebApp Role

**`roles/webapp/tasks/main.yml`**

```yaml
- name: PHP ë° í•„ìˆ˜ ëª¨ë“ˆ ì„¤ì¹˜
  apt:
    name:
      - php-fpm
      - php-mysql   # MySQL ì—°ë™ ëª¨ë“ˆ
      - php-mbstring
    state: present

- name: index.php ì†ŒìŠ¤ íŒŒì¼ ë°°í¬
  template:
    src: index.php.j2
    dest: /var/www/html/index.php
    owner: www-data # ì›¹ ì„œë²„(Nginx)ê°€ ì½ì„ ìˆ˜ ìˆëŠ” ê¶Œí•œ
    group: www-data
    mode: '0644'

```

**`roles/webapp/templates/index.php.j2`**

```php
<?php
// [ë³´ì•ˆ] DBëŠ” 127.0.0.1(localhost)ì—ì„œë§Œ ì‘ë‹µí•˜ë¯€ë¡œ í˜¸ìŠ¤íŠ¸ë¥¼ localhostë¡œ ì§€ì •
$host = 'localhost';
$user = 'webuser';
$pw = '{{ db_web_password }}'; // Vaultì—ì„œ ì£¼ì…ëœ ë¹„ë°€ë²ˆí˜¸
$dbName = 'employees';

$mysqli = new mysqli($host, $user, $pw, $dbName);

if ($mysqli->connect_errno) {
    die("<div style='color:red'>DB ì ‘ì† ì‹¤íŒ¨: " . $mysqli->connect_error . "</div>");
}

$sql = "SELECT dept_no, dept_name FROM departments LIMIT 10";
$result = $mysqli->query($sql);
?>
<!DOCTYPE html>
<html>
<head>
    <title>ì‚¬ë‚´ë§ ë¶€ì„œ ì •ë³´ ì‹œìŠ¤í…œ</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        table { border-collapse: collapse; width: 600px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: center; }
        th { background-color: #4CAF50; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
    </style>
</head>
<body>
    <h1>ğŸ¢ Employees ë¶€ì„œ ëª©ë¡ (Local DB)</h1>
    <p>ì´ í˜ì´ì§€ëŠ” ì™¸ë¶€(8080)ì—ì„œ ì ‘ì† ê°€ëŠ¥í•˜ì§€ë§Œ, DBëŠ” ë‚´ë¶€ì—ì„œë§Œ í†µì‹ í•©ë‹ˆë‹¤.</p>
    <table>
        <thead>
            <tr><th>ë¶€ì„œ ì½”ë“œ (Dept No)</th><th>ë¶€ì„œëª… (Dept Name)</th></tr>
        </thead>
        <tbody>
            <?php while($row = $result->fetch_assoc()): ?>
            <tr>
                <td><?= $row['dept_no'] ?></td>
                <td><?= $row['dept_name'] ?></td>
            </tr>
            <?php endwhile; ?>
        </tbody>
    </table>
</body>
</html>

```

---

### 5. [Step 3] í†µí•© ì‹¤í–‰ (site.yml)#yamlíŒŒì¼ì€ í‚¤:ìŒì˜ êµ¬ì¡°ì¼ ë¿ ì“°ëŠ” ì‚¬ëŒë§ˆë‹¤ ë‹¬ë¼ì§(ë„¤ì„ ë“±ë“±)     
ì•¤ì„œë¸”ì€ í¬ê²Œ ì„¤ì¹˜í•˜ëŠ” ê²ƒ/ ì„¤ì¹˜ í™˜ê²½ì„ ë°”ê¿”ì£¼ëŠ” ê²ƒìœ¼ë¡œ ë‘ ê°€ì§€ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŒ í•  ì¼ì„    
=> ë³€ìˆ˜ë“¤ì„ ëª¨ì•„ë†”ì•¼ ê² ë‹¤ => ë³€ìˆ˜ë“¤ë§Œ ëª¨ì•„ë‘” yaml íŒŒì¼
**`site.yml`**
#site.yml í•­ìƒ ì œì¼ ë¨¼ì € ì‹¤í–‰ ë˜ëŠ” íŒŒì¼
```yaml
# - ë°”ë¥¼ ì³ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ ë§Œë“¤ì–´ì„œ ë¦¬ìŠ¤íŠ¸ë¡œ ì²˜ë¦¬í•˜ë„ë¡ = -ë°”ê°€ ìˆëŠ” ê³³ë“¤ì´ í•œ ë¬¶ìŒ ì”©ì˜ ì‹œì‘ì´ ë¨ ì—¬ê¸°ì„œëŠ” name,group_vars,common,mariadb,nginx,webapp
- name: ì˜¨í”„ë ˆë¯¸ìŠ¤ ë³´ì•ˆ ì›¹/DB êµ¬ì¶• #í˜¸ì¶œí•  ë•Œ ì˜ ì“°ì§€ ì•ŠëŠ” ë‹¤ëŠ” ëœ» <-> hanldersì—ì„œëŠ” ì˜ì–´ë¡œë§Œ ì”€ ê·¸ ì´ë¦„ìœ¼ë¡œ ë¶ˆë¦¬ê¸° ë•Œë¬¸ì—(í”„ë¡œê·¸ë¨ ì•ˆì—ì„œ í•œê¸€í‚¤ ë§ì¶”ê¸° ì–´ë ¤ì›€)
  hosts: all #ì¸í”„ë¼ë¥¼ ê¹” ëŒ€ìƒ #ê´€ìŠµì ìœ¼ë¡œ inventory.iniì— hosts ì“°ê¸°ë¡œ í•¨ , hosts.ini(ê° ì„œë²„ í•œ ëŒ€ í•œ ëŒ€)ë¼ëŠ” ì´ë¦„ì€ ë¦¬ëˆ…ìŠ¤ê°€ ì°½ì‹œë˜ê¸° ì „ë¶€í„°
  become: yes # ëª¨ë“  ì‘ì—…ì€ Root ê¶Œí•œ(sudo)ìœ¼ë¡œ ìˆ˜í–‰ #ì¼ë°˜ ìœ ì €ë¡œëŠ” ì•ˆ ì”€ (ì‹œìŠ¤í…œ ëª…ë ¹ì–´ë¥¼ ë‚´ë¶€ì ìœ¼ë¡œ ë§ì´ ì‚¬ìš©í•´ì„œ) ë¯¸ë¦¬ yesí•´ë‘ë©´ ì•¤ì„œë¸”ì—ì„œ ì•Œì•„ì„œ íŒ¨ìŠ¤ì›Œë“œ ë‹¤ ì³ì„œ í—ˆë½í•´ì„œ í”„ë¡œê·¸ë¨ì´ ë‹¤ ê¹”ë ¤ìˆê²Œ ì•Œì•„ì„œ ì²˜ë¦¬ í•´ ì¤Œ ê½¤ ë¬´ê²
              # ì„œë²„ ë°°í¬ í•  ë•ŒëŠ” ë³´ì´ì§€ë„ ì•ŠëŠ” ë° sudo ì³ì„œ íŒ¨ìŠ¤ì›Œë“œ ë„£ì–´ì¤„ ìˆ˜ê°€ ì—†ê¸° ë•Œë¬¸ì— & í”„ë¡œê·¸ë¨ì„ ë§ì´ ê¹”ê¸° ë•Œë¬¸ì—
  vars_files:
    - group_vars/all/vault.yml
  roles:
    - common #ì¼ë°˜ì ì¸ ê²ƒë“¤:ê³µí†µì ì¸ ê²ƒ #ê²°êµ­ ë§¨ ê¼­ë‹¤ê¸°ì˜ roles ì•ˆì˜ ì´ë¦„ë“¤ì´ë‘ ë˜‘ê°™ì´ ì¼ì¹˜í•´ì•¼ í•¨ #rolesë””ë ‰í† ë¦¬ ë°‘ì— 
    - mariadb #DBì„œë²„ ê¹” ê² ë‹¤ëŠ” ê²ƒ
    - nginx
    - webapp

```

**ì‹¤í–‰ ëª…ë ¹ì–´:**

```bash
# Vault ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì„ ìš”ì²­í•˜ë©° í”Œë ˆì´ë¶ ì‹¤í–‰
ansible-playbook -i inventory.ini site.yml --ask-vault-pass

```

---

### ìš”ì•½ ë° ê²€ì¦ í¬ì¸íŠ¸

1. **Nginx ì ‘ì†:** ë¸Œë¼ìš°ì €ì—ì„œ `http://ì„œë²„IP:8080`ìœ¼ë¡œ ì ‘ì†í•˜ë©´ ë¶€ì„œ ëª©ë¡ì´ í‘œë¡œ ì¶œë ¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
2. **DB ë³´ì•ˆ í™•ì¸:**
* ì™¸ë¶€ PC(DBeaver ë“±)ì—ì„œ `ì„œë²„IP:3306`ìœ¼ë¡œ ì ‘ì† ì‹œë„ ì‹œ **ì ‘ì† ê±°ë¶€(Connection Refused)**ê°€ ë°œìƒí•´ì•¼ ì •ìƒì…ë‹ˆë‹¤. (bind-addressê°€ ë§‰ê³  ìˆìŒ)
* ì„œë²„ ë‚´ë¶€ í„°ë¯¸ë„ì—ì„œ `mysql -u dbadmin -p`ë¡œ ì ‘ì† ì‹œ ì •ìƒ ë¡œê·¸ì¸ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.


3. **ë°ì´í„°:** `employees` ë°ì´í„°ë² ì´ìŠ¤ì— ë°ì´í„°ê°€ ì •ìƒì ìœ¼ë¡œ import ë˜ì—ˆëŠ”ì§€ í˜ì´ì§€ì˜ í‘œ ë‚´ìš©ì„ í†µí•´ í™•ì¸í•©ë‹ˆë‹¤.

Next Step: **Giteaì™€ Jenkinsë¥¼ ì—°ë™í•œ CI/CD íŒŒì´í”„ë¼ì¸ êµ¬ì¶•**
