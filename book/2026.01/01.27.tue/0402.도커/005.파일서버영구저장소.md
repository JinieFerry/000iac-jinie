# 파일서버 만들기 실습!  
파일 서버 만들면 서로 공유도 가능
https://drive.google.com/drive/folders/1o6K1IQ5JQ4u9BdyBfRNINgwZgjVqCJc_

>_ 파일 서버 실해 run file server #볼륨에 파일 올리면 사라지는지 확인
파일 브라우저 (프로그램) 가장 많이 쓰임 

### 포트 8080 말고 다른 거로 실습하기 + 도커파일로 직접 iac 만들어서 파일도 올려보기 + 코드 충돌나지 않게 바꾸기 + 디렉토리 만들어두고 조정하기 + 에러나지 않게 권한 주기

### 이미지 다운받아서 하는 건 IaC아님 : 명세서가 없으니까

## 실습1
#### DOCKER시스템 아키텍처
```
# 1) 이미지 다운로드 확인
$ docker iamge ls | head -n 3

# 2) 실행 중인 컨테이너 확인
$ docker ps --filter name=file-server

# 3) 볼륨 마운드 정보 검사
$ docker inspect fiel-server\
--format'{{.json .Mounts}}'|jq
[{"Type":"volume","Name":"my-data",...}]
```

#### 환경 준비: 설치 및 권한 확인
```
#1 도커 버전 확인
$ docker --version

#2 서버 정보 및 연결 확인
$ docker info --format 'ServerVersion:{{.ServerVersion}}'

#3 필요시) 권한 설정 : 리눅스
$ sudo usermod -aG docker $USER && newgrp docker

#4 포트 8080 사용 가능 여부 확인
$ ss -ltnp|grep :8080||echo "Port 8080 is free"
```

#### 볼륨 생성
```
#1 'my-data'가 볼륨 이름
$ docker volume create my-data

#볼륨 정상 생성 확인 - 목록으로
$ docker volume ls | grep my-data

#볼륨 물리적 경로 및 메타데이터 확인=제이슨 파싱
$ docker volume inspect my-data|jq'.[0]|{Name,Mountpoint}'
```
#### 파일서버 실행
```
#-v옵션으로 연결됨
#user@host:~
$ docker run -d --name file-server\-p 8080:80\-v my-data:/srv \
filebrowser/filebrowser
#Output: a1b2c3d4e5f6~~~~~(Contariner ID)

#2 컨테이너 실행 상태 확인 
$ docker ps --filter name=file-server
#Output: CONTAINER ID IMAGE STATUS PORTSa1b2c3d4~~

#관리자에 대해서 패스워드 줌
$ docker exec file-server filebrowser users add admin 'Pass1234'--perm.admin
#Output: User admin created successfully

#### 데이터 영속성 테스트

# 테스트 파일 생성 및 확인
$ docker exec file-server sh -lc 'echo persisted > /srv/persist.txt && ls -l /srv'

# 컨테이너 강제 삭제 : 볼륨은 삭제되지 않음
$ docker rm -f file-server

# 새 컨테이너 실행 : 기존 볼륨 연결
$ docker run -d --name file-server -p 8080:80 -v my-data:/srv filebrowser/filebrowser

# 데이터 생존 확인
$ docker exec file-server cat /srv/persist.txt
```

admin 비밀번호 이제 매번 새로운 랜덤 패스워드 생성으로 정책 바뀜
<img width="1920" height="1040" alt="image" src="https://github.com/user-attachments/assets/c92c4c3b-df61-46d5-a80d-dbc91d90075a" />
왜 로그인 안 되냐면 (정확한 원인)

컨테이너를 재생성했는데 /config·/database를 볼륨으로 안 묶으면  admin 비밀번호가 매번 새로 랜덤 생성 됨   

로그확인
```
Performing quick setup
User 'admin' initialized with randomly generated password: HhLykgUOcQh73WJ0
```



지금 실행 중인 컨테이너의 비밀번호는 로그에 찍힌 최신 값 만 유효함

-> 그러면 UI에서 “사용자 이름 또는 비밀번호를 확인하십시오”가 뜸


1. 현재 컨테이너의 최신 비밀번호 다시 확인
`docker logs --tail 50 file-server | grep password`


나오는 값 그대로 복사해서 로그인:

ID: admin

PW: (방금 로그에 나온 값)



2. 비밀번호를 매번 확인하지 않으려면 설정/DB도 볼륨으로 고정해야 함

지금은 /srv만 영구화했고, 비밀번호가 저장되는 /config, /database는 휘발이라 매번 초기화됨. (정책이 그럼)
```
# 1)  볼륨 2개 추가
docker volume create fb-config
docker volume create fb-db

# 2) 컨테이너 다시 실행 (정석방식)
docker rm -f file-server

docker run -d --name file-server \
  -p 8081:80 \
  -v my-data:/srv \
  -v fb-config:/config \
  -v fb-db:/database \
  --restart unless-stopped \
  filebrowser/filebrowser:latest

# 3) 한 번만 로그로 비번 확인
docker logs --tail 20 file-server


 이제부터는 컨테이너를 지웠다 다시 띄워도 비밀번호 안 바뀜
```

> 데이터만 볼륨으로 묶으면 파일만 영구화되고,
> 설정/계정까지 영구화하려면 config·database도 볼륨으로 분리해야 한다.

