### ì½”ë“œ ìˆ˜ì • ë§ì•˜ìŒ í™•ì¸í•„ìš”

<ìˆ˜ì • ì „>
https://github.com/putto4u/04.PrivateCloudInfra/blob/main/01.%EB%8F%84%EC%BB%A4%EB%B0%8F%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EC%84%A4%EC%B9%98/020.%EC%95%A4%EC%84%9C%EB%B8%94%EB%A1%9C%20%EB%8F%84%EC%BB%A4%EC%99%80%20k8s%EB%A7%88%EC%8A%A4%ED%84%B0%EC%84%A4%EC%B9%98.md

<ìˆ˜ì • í›„>
https://github.com/putto4u/04.PrivateCloudInfra/blob/main/01.%EB%8F%84%EC%BB%A4%EB%B0%8F%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EC%84%A4%EC%B9%98/021.%EC%95%A4%EC%84%9C%EB%B8%94%EB%A1%9C%20%EB%8F%84%EC%BB%A4%EC%99%80%20%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4%EC%84%A4%EC%B9%98.md.md

<img width="1920" height="1040" alt="image" src="https://github.com/user-attachments/assets/4b371cb8-408d-4654-ae28-e08ec8d46b2d" />
<img width="1920" height="1040" alt="image" src="https://github.com/user-attachments/assets/e76528ab-814e-412b-8480-c2dd862f8df2" />
shoule change as master and set password:1234


ìë™í™” ì „ë¬¸ê°€ì˜ ê´€ì ì—ì„œ, **Ansible Playbook**ì„ ì´ìš©í•œ Dockerì™€ Kubernetes(K8s) ì„¤ì¹˜ëŠ” ì¸í”„ë¼ë¥¼ ì¼ê´€ë˜ê³  ë°˜ë³µ ê°€ëŠ¥í•˜ë©° í™•ì¥ì„± ìˆê²Œ êµ¬ì¶•í•˜ëŠ” **ê°€ì¥ í‘œì¤€ì ì¸ ë°©ë²•**ì…ë‹ˆë‹¤.

Docker ì„¤ì¹˜ëŠ” ë¹„êµì  ê°„ë‹¨í•˜ì§€ë§Œ, K8s í´ëŸ¬ìŠ¤í„° êµ¬ì¶•ì€ \*\*`kubeadm`\*\*ì„ ê¸°ë°˜ìœ¼ë¡œ ë³µì¡í•œ ì„ í–‰ ì¡°ê±´ê³¼ ë§ˆìŠ¤í„°/ì›Œì»¤ ë…¸ë“œë³„ ì‘ì—…ì„ ìš”êµ¬í•©ë‹ˆë‹¤. ì´ ëª¨ë“  ê³¼ì •ì„ í•˜ë‚˜ì˜ Playbook ì„¸íŠ¸ë¡œ ìë™í™”í•˜ëŠ” ê²ƒì´ í•µì‹¬ì…ë‹ˆë‹¤.         
 
0. í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°
ansible-devops-project/
â”œâ”€â”€ inventory/
â”‚   â””â”€â”€ hosts.ini            # ëŒ€ìƒ Windows í˜¸ìŠ¤íŠ¸ PC ë¦¬ìŠ¤íŠ¸
â”œâ”€â”€ vars/
â”‚   â””â”€â”€ main.yml             # ì„¤ì¹˜ íŒŒì¼ ë²„ì „, ê²½ë¡œ ë° ê³„ì • ì •ë³´
â””â”€â”€ site.yml                 # ì „ì²´ ê³µì • í†µí•© í”Œë ˆì´ë¶

ì§€ë‹ˆë¡œê·¸
```
#ì˜¤ëŠ˜ì ì‹¤ìŠµ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
master@master01:~$ cd ~/sej/silsoup/0128wed
master@master01:~/sej/silsoup/0128wed$ pwd
/home/master/sej/silsoup/0128wed

# í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„± ì‹œì‘
master@master01:~/sej/silsoup/0128wed$ mkdir k8s
master@master01:~/sej/silsoup/0128wed$ cd k8s
master@master01:~/sej/silsoup/0128wed/k8s$ mkdir inventory vars
master@master01:~/sej/silsoup/0128wed/k8s$ touch inventory/hosts.ini
master@master01:~/sej/silsoup/0128wed/k8s$ tree
.
â”œâ”€â”€ inventory
â”‚Â Â  â””â”€â”€ hosts.ini
â””â”€â”€ vars

3 directories, 1 file
master@master01:~/sej/silsoup/0128wed/k8s$ 


ã…‡
```
### 1\. Ansible í™˜ê²½ ë° ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­

Dockerì™€ K8s ì„¤ì¹˜ë¥¼ ìë™í™”í•˜ê¸° ì „ì— ë‹¤ìŒ ì‚¬í•­ì´ ì „ì œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

  * **Ansible ì»¨íŠ¸ë¡¤ ë…¸ë“œ:** Playbookì„ ì‹¤í–‰í•  ì¤‘ì•™ ì„œë²„(SSH ì ‘ì† ë° Ansible ì„¤ì¹˜ í•„ìˆ˜).
  * **ê´€ë¦¬ ëŒ€ìƒ ë…¸ë“œ(Target Nodes):** Dockerì™€ K8sê°€ ì„¤ì¹˜ë  VM ë˜ëŠ” ì„œë²„. (OS: Ubuntu ë˜ëŠ” CentOS ê¶Œì¥)
  * **SSH í‚¤ ê¸°ë°˜ ì¸ì¦:** ì»¨íŠ¸ë¡¤ ë…¸ë“œì—ì„œ ëª¨ë“  ëŒ€ìƒ ë…¸ë“œë¡œ ë¹„ë°€ë²ˆí˜¸ ì—†ì´ \*\*`ssh-copy-id`\*\*ë¥¼ í†µí•´ ì ‘ì† ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤. (`ansible_become: yes` ì‚¬ìš© ì‹œ sudo ë¹„ë°€ë²ˆí˜¸ ì—†ì´ ê¶Œí•œ ìƒìŠ¹ ê°€ëŠ¥)
  * **Inventory íŒŒì¼ êµ¬ì„±:** ë§ˆìŠ¤í„° ë…¸ë“œì™€ ì›Œì»¤ ë…¸ë“œë¥¼ ëª…í™•íˆ êµ¬ë¶„í•˜ëŠ” ê·¸ë£¹ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

<!-- end list -->

```ini
#ë§ˆìŠ¤í„° ìŠ¤í‚µ
#[master]
#k8s-master ansible_host=192.168.1.10

[worker]
#ì›Œì»¤ë¡œ ì‚¬ìš© í•  ê²ƒ
worker1 ansible_host=192.168.115.1
worker2 ansible_host=192.168.115.2
#k8s-worker1 ansible_host=192.168.1.11
#k8s-worker2 ansible_host=192.168.1.12

[all:vars]
ansible_user=master #ìš°ë¶„íˆ¬ëŠ” ì•„ë§ˆì¡´ ë“¤ì–´ ê°ˆ ë•Œ ì“°ë˜ ê±°
ansible_become=yes # sudo ê¶Œí•œ ì‚¬ìš©
```

-----
### 012.k8sì„¤ì¹˜í•˜ê¸°.mdì™€ ë¹„êµí•´ì„œ ì„¤ëª…: aptì— ì§ì ‘ ì³ì„œ í–ˆë˜ ê²ƒ ë“¤ì´ yamlì—ì„œëŠ” ì–´ë–»ê²Œ ì²˜ë¦¬í•˜ëŠ”ì§€ í™•ì¸
### 2\. Playbookì„ ì´ìš©í•œ Docker ì„¤ì¹˜ (Container Runtime)

K8sëŠ” \*\*ì»¨í…Œì´ë„ˆ ëŸ°íƒ€ì„ ì¸í„°í˜ì´ìŠ¤(CRI)\*\*ë¥¼ í•„ìš”ë¡œ í•©ë‹ˆë‹¤. **Containerd**ê°€ ì¿ ë²„ë„¤í‹°ìŠ¤ì˜ ê¸°ë³¸ ëŸ°íƒ€ì„ì´ì§€ë§Œ, Dockerë¥¼ í¬í•¨í•˜ì—¬ ì„¤ì¹˜í•˜ëŠ” ê²ƒì´ ê´€ë¦¬ í¸ì˜ì„±ì—ì„œ ìœ ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**`docker-install.yml`** (ëª¨ë“  ë…¸ë“œì—ì„œ ì‹¤í–‰)

```yaml
---
- name: ğŸš€ Install Docker (Container Runtime for K8s)
  hosts: all
  become: yes
  tasks:
    # 1. ì‹œìŠ¤í…œ ì—…ë°ì´íŠ¸ ë° í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
    - name: Update apt cache and install prerequisites
      ansible.builtin.apt:
        name: 
          - apt-transport-https
          - ca-certificates
          - curl
          - software-properties-common
        state: present
        update_cache: yes

    # 2. Docker GPG í‚¤ ë° Repository ì¶”ê°€
    - name: Add Docker GPG apt Key
      ansible.builtin.apt_key:
        url: https://download.docker.com/linux/ubuntu/gpg
        state: present
        
    - name: Add Docker Repository
      ansible.builtin.apt_repository:
        repo: deb [arch=amd64] https://download.docker.com/linux/ubuntu {{ ansible_distribution_release }} stable
        state: present
        
    # 3. Docker Engine ë° ê´€ë ¨ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (containd.io í¬í•¨)
    - name: Install Docker Packages
      ansible.builtin.apt:
        name: 
          - docker-ce
          - docker-ce-cli
          - containerd.io
        state: present

    # 4. ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ Docker ê¶Œí•œ ë¶€ì—¬
    - name: Add user to docker group
      ansible.builtin.user:
        name: "{{ ansible_user }}"
        groups: docker
        append: yes
```

-----

### 3\. Playbookì„ ì´ìš©í•œ Kubernetes ì„¤ì¹˜ (kubeadm ê¸°ë°˜)

ì¿ ë²„ë„¤í‹°ìŠ¤ ì„¤ì¹˜ëŠ” **ìŠ¤ì™‘ ë¹„í™œì„±í™”, ë„¤íŠ¸ì›Œí¬ ì„¤ì •, Kube-tools ì„¤ì¹˜, í´ëŸ¬ìŠ¤í„° ì´ˆê¸°í™”**ì˜ 4ë‹¨ê³„ë¡œ ë‚˜ë‰©ë‹ˆë‹¤.

#### A. Pre-requisite Playbook (`k8s-prep.yml`)

K8s ì„¤ì¹˜ë¥¼ ìœ„í•œ ì„ í–‰ ì¡°ê±´(ëª¨ë“  ë…¸ë“œì—ì„œ í•„ìˆ˜)ì„ ì„¤ì •í•©ë‹ˆë‹¤.

```yaml
---
- name: âš™ï¸ Kubernetes Pre-requisites Setup
  hosts: all
  become: yes
  tasks:
    # 1. Swap ë©”ëª¨ë¦¬ ë¹„í™œì„±í™” (Kubelet ìš”êµ¬ ì‚¬í•­)
    - name: Disable swap permanently (comment out fstab entry)
      ansible.builtin.replace:
        path: /etc/fstab
        regexp: '^(\s*)([^#]+\s+swap\s+sw\s+.*)$'
        replace: '#\2'
        
    - name: Turn off swap immediately
      ansible.builtin.command: swapoff -a
      when: ansible_swaptotal_mb > 0

    # 2. ë¸Œë¦¿ì§€ ë„¤íŠ¸ì›Œí¬ íŠ¸ë˜í”½ì— ëŒ€í•œ iptables í™•ì¸ ì„¤ì • (K8s ë„¤íŠ¸ì›Œí‚¹ í•„ìˆ˜)
    - name: Configure sysctl for Kubernetes networking
      ansible.builtin.sysctl:
        name: "{{ item }}"
        value: '1'
        state: present
        reload: yes
      loop:
        - net.bridge.bridge-nf-call-iptables
        - net.bridge.bridge-nf-call-ip6tables
        - net.ipv4.ip_forward
        
    # 3. Kubernetes Tools ì„¤ì¹˜ (kubeadm, kubelet, kubectl)
    - name: Add Kubernetes GPG Key
      ansible.builtin.apt_key:
        url: https://packages.cloud.google.com/apt/doc/apt-key.gpg
        state: present

    - name: Add Kubernetes Repository
      ansible.builtin.apt_repository:
        # ì‚¬ì´íŠ¸ ë°”ê¼ˆìŒ
        repo: deb https://pkgs.k8s.io/ kubernetes-xenial main
        state: present
        filename: kubernetes

    # ë²„ì „ ìœ ì§€í•´ë¼
    - name: Install kubelet, kubeadm, kubectl and hold their versions
      ansible.builtin.apt:
        name: 
          - kubelet={{ kube_version }} #jinja2ë³€ìˆ˜ëª… 
          - kubeadm={{ kube_version }}
          - kubectl={{ kube_version }}
        #ê¹”ë ¤ìˆìœ¼ë©´ ë†”ë‘ê¸°
        state: present
        #ë²„ì „ì€ ìœ ì§€í•˜ê³  ì—…ë°ì´íŠ¸ë§Œ : ë²„ì „ì„ ë§ˆì§€ë§‰ ëìë¦¬ê¹Œì§€ í•˜ëŠ”ì§€, ì¤‘ê°„ê¹Œì§€ë§Œ í•˜ëŠ”ì§€ë„ ë‹¤ë¦„:í”„ë¡œê·¸ë˜ë¨¸ì˜ ê³ ë ¤ì‚¬í•­ì— ìˆì„ ìˆ˜ ìˆìŒ
        #ë²„ì „ì˜ ë§ˆì§€ë§‰ ëìë¦¬ëŠ” ìœ— ë²„ì „ì— ì˜í–¥ì„ ì£¼ì§€ì•ŠëŠ”ë‹¤ëŠ” ëœ»
        update_cache: yes

    - name: Mark K8s packages to hold (prevent accidental upgrade)
      ansible.builtin.dpkg_selections:
        name: "{{ item }}"
        selection: hold
      loop:
        - kubelet
        - kubeadm
        - kubectl
```

#### B. Master Node ì´ˆê¸°í™” (`k8s-master-init.yml`)

ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ í´ëŸ¬ìŠ¤í„°ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì›Œì»¤ ë…¸ë“œê°€ ì¡°ì¸í•  í† í°ì„ ìƒì„±í•©ë‹ˆë‹¤.


```yaml
---
- name: ğŸ‘‘ Initialize Kubernetes Master Node
  hosts: master
  become: yes
  vars:
    # ì˜ˆ: ì›í•˜ëŠ” K8s ë²„ì „ (Playbook ì‹¤í–‰ ì‹œ --extra-vars "kube_version=1.29.0-00" ë¡œ ë³€ê²½ ê°€ëŠ¥)
    kube_version: "1.29.0-00" 
    pod_network_cidr: "10.244.0.0/16" # Calico CNI í‘œì¤€ CIDR
  tasks:
    - name: Initialize the Kubernetes Cluster (kubeadm init)
      ansible.builtin.command: >
        kubeadm init 
        --pod-network-cidr={{ pod_network_cidr }} 
        --ignore-preflight-errors=NumCPU
      register: kubeadm_init_result # ê²°ê³¼ ì €ì¥

    - name: Create .kube directory for cluster config
      ansible.builtin.file:
        path: /home/{{ ansible_user }}/.kube
        state: directory
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
        mode: '0755'
        
    - name: Copy admin.conf to user's .kube directory
      ansible.builtin.copy:
        src: /etc/kubernetes/admin.conf
        dest: /home/{{ ansible_user }}/.kube/config
        remote_src: yes
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
        mode: '0600'

    # Flannel CNI ì„¤ì¹˜ (ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸)
    - name: Install Flannel CNI Network Plugin
      ansible.builtin.command: >
        kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml

    # ì›Œì»¤ ë…¸ë“œ ì¡°ì¸ ëª…ë ¹ ìƒì„± (í† í° ì¶”ì¶œ)
    - name: Generate join command for worker nodes
      ansible.builtin.command: >
        kubeadm token create --print-join-command
      register: join_command_result
    
    - name: Display join command
      ansible.builtin.debug:
        msg: "Worker Join Command: {{ join_command_result.stdout }}"
      delegate_to: localhost # ê²°ê³¼ë¥¼ ì»¨íŠ¸ë¡¤ ë…¸ë“œ í„°ë¯¸ë„ì— ì¶œë ¥
```

ì•„ë˜ì—ì„œ ìœ„ì˜ ì½”ë“œë¡œ ìˆ˜ì •ë¨ : Cisco CLI -> Flannel CLIë¡œ ë³€ê²½

```yaml
---
- name: ğŸ‘‘ Initialize Kubernetes Master Node
  hosts: master
  become: yes
  vars:
    # ì˜ˆ: ì›í•˜ëŠ” K8s ë²„ì „ (Playbook ì‹¤í–‰ ì‹œ --extra-vars "kube_version=1.29.0-00" ë¡œ ë³€ê²½ ê°€ëŠ¥)
    kube_version: "1.29.0-00" 
    pod_network_cidr: "10.244.0.0/16" # Calico CNI í‘œì¤€ CIDR
  tasks:
    - name: Initialize the Kubernetes Cluster (kubeadm init)
      ansible.builtin.command: >
        kubeadm init 
        --pod-network-cidr={{ pod_network_cidr }} 
        --ignore-preflight-errors=NumCPU
      register: kubeadm_init_result # ê²°ê³¼ ì €ì¥

    - name: Create .kube directory for cluster config
      ansible.builtin.file:
        path: /home/{{ ansible_user }}/.kube
        state: directory
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
        mode: '0755'
        
    - name: Copy admin.conf to user's .kube directory
      ansible.builtin.copy:
        src: /etc/kubernetes/admin.conf
        dest: /home/{{ ansible_user }}/.kube/config
        remote_src: yes
        owner: "{{ ansible_user }}"
        group: "{{ ansible_user }}"
        mode: '0600'

    # Calico CNI ì„¤ì¹˜ (ë„¤íŠ¸ì›Œí¬ í”ŒëŸ¬ê·¸ì¸)
    - name: Install Calico CNI Network Plugin
      ansible.builtin.command: >
        kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml

    # ì›Œì»¤ ë…¸ë“œ ì¡°ì¸ ëª…ë ¹ ìƒì„± (í† í° ì¶”ì¶œ)
    - name: Generate join command for worker nodes
      ansible.builtin.command: >
        kubeadm token create --print-join-command
      register: join_command_result
    
    - name: Display join command
      ansible.builtin.debug:
        msg: "Worker Join Command: {{ join_command_result.stdout }}"
      delegate_to: localhost # ê²°ê³¼ë¥¼ ì»¨íŠ¸ë¡¤ ë…¸ë“œ í„°ë¯¸ë„ì— ì¶œë ¥
```

#### C. Worker Node ì¡°ì¸ (`k8s-worker-join.yml`)

ì›Œì»¤ ë…¸ë“œë¥¼ í´ëŸ¬ìŠ¤í„°ì— í•©ë¥˜ì‹œí‚µë‹ˆë‹¤. (ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ ì–»ì€ í† í° ì‚¬ìš©)
```
# í™•ì¸í•´ë´…ì‰¬ë‹¤
#ë§ˆìŠ¤í„°ë…¸ë“œì—ì„œ í† í° ìƒì„±í•˜ê¸°
$ kubeadm token create --print-join-command #ì¹˜ë©´ í‚¤ ê°’ì´ ë‚˜ì˜¬ ê²ƒ
# ê²°ê³¼ê°’ì´ ë‚˜ì˜¤ë©´ ë©”ë³´ì¥ì„ ì—´ì–´ì„œ ë³µì‚¬í•´ ë‘¡ë‹ˆë‹¤.

```


ë§ˆìŠ¤í„°ë…¸ë“œì— í† í° ìƒì„±í•˜ê¸°
```

```

```yaml
---
- name: ğŸ¤ Join Worker Nodes to Cluster
  hosts: worker
  become: yes
  tasks:
    # Master Playbookì—ì„œ ìƒì„±ëœ í† í°ì„ ë³µì‚¬í•˜ì—¬ ì‹¤í–‰
    - name: Execute join command on worker nodes
      ansible.builtin.shell:
        #cmd: "{{ hostvars['k8s-master']['join_command_result']['stdout'] }}" #ì›ë˜ì½”ë“œ
    
        cmd: "" #ë”°ì˜´í‘œ ì•ˆì— ìœ„ì—ì„œ ë©”ëª¨ì¥ì— ë³µì‚¬í•´ ë‘” í‚¤ë¥¼ ë„£ìŒ
      register: join_output
      changed_when: join_output.rc == 0
```

-----

### 4\. ì‹¤í–‰ ìˆœì„œ ë° ë§ˆë¬´ë¦¬

Playbookì€ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

1.  **Docker ì„¤ì¹˜:**
    ```bash
    ansible-playbook docker-install.yml -i inventory
    ```
2.  **K8s ì‚¬ì „ ì¤€ë¹„:**
    ```bash
    ansible-playbook k8s-prep.yml -i inventory
    ```
3.  **ë§ˆìŠ¤í„° ë…¸ë“œ ì´ˆê¸°í™”:**
    ```bash
    ansible-playbook k8s-master-init.yml -i inventory
    ```
4.  **ì›Œì»¤ ë…¸ë“œ ì¡°ì¸:**
    ```bash
    ansible-playbook k8s-worker-join.yml -i inventory
    ```

**ìµœì¢… í™•ì¸:** ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì—¬ ëª¨ë“  ë…¸ë“œê°€ **`Ready`** ìƒíƒœì¸ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```bash
kubectl get nodes
```

ì´ ìë™í™”ëœ ì ‘ê·¼ ë°©ì‹ì€ DevOps í™˜ê²½ì—ì„œ ê°€ì¥ íš¨ìœ¨ì ì¸ í´ëŸ¬ìŠ¤í„° êµ¬ì¶• ë°©ë²•ì´ë©°, í•„ìš” ì‹œ **Kubespray**ì™€ ê°™ì€ ì „ë¬¸ì ì¸ Ansible ê¸°ë°˜ K8s ì„¤ì¹˜ ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
---## Kubernetes ë§ˆìŠ¤í„° ë…¸ë“œ ìê¸° ìì‹ (Self) í• ë‹¹ ê°€ì´ë“œ

ë„¤, **ë§ˆìŠ¤í„° ë…¸ë“œì—ì„œ ìê¸° ìì‹ ì„ ëŒ€ìƒìœ¼ë¡œ Ansible Playbookì„ ì‹¤í–‰í•˜ëŠ” ê²ƒì€ ê¸°ìˆ ì ìœ¼ë¡œ ê°€ëŠ¥í•˜ë©°, ì‹¤ìŠµ í™˜ê²½ì—ì„œëŠ” ë§¤ìš° ì¼ë°˜ì ì¸ ë°©ì‹**ì…ë‹ˆë‹¤.

ë‹¤ë§Œ, ì›ê²© PCë¥¼ ì œì–´í•  ë•Œì™€ëŠ” ëª‡ ê°€ì§€ ì„¤ì • ì°¨ì´ê°€ ìˆìœ¼ë¯€ë¡œ ì´ë¥¼ ì •í™•íˆ ì´í•´í•˜ê³  ë°˜ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

---

### 1. ìê¸° ìì‹ ì„ ì œì–´í•  ë•Œì˜ Inventory ì„¤ì •

Ansible ì»¨íŠ¸ë¡¤ ë…¸ë“œ(ëª…ë ¹ì„ ë‚´ë¦¬ëŠ” PC)ê°€ ë™ì‹œì— Kubernetes ë§ˆìŠ¤í„° ë…¸ë“œê°€ ë  ê²½ìš°, `inventory` íŒŒì¼ì—ì„œ `ansible_connection=local` ì„¤ì •ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ íš¨ìœ¨ì ì…ë‹ˆë‹¤.

#### ìˆ˜ì •ëœ `inventory` ì˜ˆì‹œ

```ini
[master]
# ìê¸° ìì‹ ì„ ê°€ë¦¬í‚¬ ë•Œ 'localhost'ì™€ 'local' ì—°ê²° ë°©ì‹ ì‚¬ìš©
localhost ansible_connection=local

[worker]
k8s-worker1 ansible_host=192.168.0.101
k8s-worker2 ansible_host=192.168.0.102

[all:vars]
ansible_user=master
ansible_become=yes

```

---

### 2. ìê¸° ìì‹ (Localhost) ì‹¤í–‰ ì‹œ ì£¼ì˜ì‚¬í•­

1. **SSH í‚¤ ìƒëµ ê°€ëŠ¥:** `ansible_connection=local`ì„ ì‚¬ìš©í•˜ë©´ SSH í”„ë¡œí† ì½œì„ ê±°ì¹˜ì§€ ì•Šê³  ì§ì ‘ ë‚´ë¶€ ì‰˜ ëª…ë ¹ì„ ì‹¤í–‰í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ìê¸° ìì‹ ì— ëŒ€í•´ `ssh-copy-id`ë¥¼ í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.
2. **ê¶Œí•œ ìƒìŠ¹(Become):** ë¡œì»¬ ì‹¤í–‰ì´ë¼ í•˜ë”ë¼ë„ K8s ì„¤ì¹˜ëŠ” ë£¨íŠ¸ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ì‹¤í–‰ ì‹œ `sudo` ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¬»ì§€ ì•Šë„ë¡ ì„¤ì •í•˜ê±°ë‚˜, ì‹¤í–‰ ëª…ë ¹ì— `-K` ì˜µì…˜ì„ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.
* `ansible-playbook -i inventory site.yml -K`


3. **IP ì£¼ì†Œ ë°”ì¸ë”©:** `kubeadm init` ì‹¤í–‰ ì‹œ `--apiserver-advertise-address` ì˜µì…˜ì„ ëª…ì‹œí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. `localhost`ë¡œ ì‹¤í–‰í•˜ë”ë¼ë„ í´ëŸ¬ìŠ¤í„°ëŠ” ì™¸ë¶€(ì›Œì»¤ ë…¸ë“œ)ì™€ í†µì‹ í•´ì•¼ í•˜ë¯€ë¡œ **ë£¨í”„ë°±(127.0.0.1)ì´ ì•„ë‹Œ ì‹¤ì œ ì‚¬ì„¤ IP**ë¥¼ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.

---

### 3. Playbook ìˆ˜ì • ì œì•ˆ (`k8s-master-init.yml`)

ìê¸° ìì‹ ì„ ë§ˆìŠ¤í„°ë¡œ ì¡ì„ ë•Œ, IP ì£¼ì†Œë¥¼ ë™ì ìœ¼ë¡œ í• ë‹¹ë°›ì•„ ì´ˆê¸°í™”í•˜ë„ë¡ íƒœìŠ¤í¬ë¥¼ ë³´ê°•í•˜ë©´ ë”ìš± ì•ˆì •ì ì…ë‹ˆë‹¤.

```yaml
    - name: Initialize the Kubernetes Cluster
      ansible.builtin.command: >
        kubeadm init 
        --pod-network-cidr={{ pod_network_cidr }} 
        --apiserver-advertise-address={{ ansible_default_ipv4.address }}
        --ignore-preflight-errors=NumCPU

```

---

### 4. ì¥ë‹¨ì  ìš”ì•½

| êµ¬ë¶„ | ì¥ì  | ë‹¨ì /ì£¼ì˜ì‚¬í•­ |
| --- | --- | --- |
| **ìê¸° ìì‹ (Local)** | ë³„ë„ì˜ ë§ˆìŠ¤í„° VMì´ í•„ìš” ì—†ì–´ ìì›ì´ ì ˆì•½ë¨. SSH ì„¤ì • ë¶ˆí•„ìš”. | ì»¨íŠ¸ë¡¤ ë…¸ë“œ ë¬¸ì œ ë°œìƒ ì‹œ í´ëŸ¬ìŠ¤í„° ì „ì²´ ê´€ë¦¬ ë¶ˆëŠ¥. |
| **ì›ê²© ë§ˆìŠ¤í„°(Remote)** | ì‹¤ì œ ìš´ì˜ í™˜ê²½ê³¼ ê°€ì¥ ìœ ì‚¬í•¨. ì—­í•  ë¶„ë¦¬ê°€ ëª…í™•í•¨. | ë§ˆìŠ¤í„° ì „ìš© VM ì‚¬ì–‘ì´ ì¶”ê°€ë¡œ í•„ìš”í•¨(ìµœì†Œ 2ê°œ CPU, 2GB RAM). |

---

### ê²°ë¡ : ì‹¤ìŠµìš©ìœ¼ë¡œëŠ” "YES"

í˜„ì¬ ì§„í–‰ ì¤‘ì¸ êµì¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” **ë§ˆìŠ¤í„° ì„œë²„(ì»¨íŠ¸ë¡¤ ë…¸ë“œ)ê°€ ìŠ¤ìŠ¤ë¡œ ë§ˆìŠ¤í„° ë…¸ë“œ ì—­í• ì„ ìˆ˜í–‰**í•˜ë„ë¡ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ë¦¬ì†ŒìŠ¤ íš¨ìœ¨ì„± ë©´ì—ì„œ ë§¤ìš° ì¢‹ì€ ì„ íƒì…ë‹ˆë‹¤. ìœ„ì—ì„œ ì–¸ê¸‰í•œ `ansible_connection=local` ë°©ì‹ê³¼ ì‹¤ì œ IP ë°”ì¸ë”© ì£¼ì†Œë§Œ ì‹ ê²½ ì“°ì‹œë©´ ë¬¸ì œì—†ì´ ì‘ë™í•©ë‹ˆë‹¤.

Next Step: ë§ˆìŠ¤í„° ë…¸ë“œ ìê¸° ìì‹  í• ë‹¹ ì‹œ ë°œìƒí•  ìˆ˜ ìˆëŠ” 'localhost' í†µì‹  ì˜¤ë¥˜ í•´ê²° ë°©ë²•
