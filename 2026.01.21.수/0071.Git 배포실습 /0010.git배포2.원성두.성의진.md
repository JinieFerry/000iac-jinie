### 실습 프로젝트: Git & Ansible을 활용한 웹 인프라 자동화 구축

본 실습은 관리자 PC에서 작성한 코드를 **GitHub**를 거쳐 실제 서버 10대에 **Ansible**로 자동 배포하는 전체 과정을 다룹니다.

---

## 1. 실습 환경 및 디렉토리 정의

* **프로젝트 이름**: `web_dep`
* **작업 디렉토리 (내 PC)**: `~/projects/web_dep`
* **대상 서버 (Managed Nodes)**: `192.168.10.101` ~ `192.168.10.110` (총 10대) #우리는 각자 짝꿍만
* **원격 저장소**: GitHub ([https://github.com/사용자계정/web_dep.git](https://www.google.com/url?sa=E&source=gmail&q=https://github.com/사용자계정/web_dep.git))

---

## 2. [내 PC] 프로젝트 초기화 및 보안 설정

관리자 PC의 특정 디렉토리에서 작업을 시작하며, 민감한 정보가 외부로 유출되지 않도록 설정합니다.

```bash
# 1. 작업 디렉토리 생성 및 이동
mkdir -p ~/projects/web_dep #자기꺼 넣어야 함
cd ~/projects/web_dep #자기꺼 넣어야 함

# 2. Git 저장소 초기화
git init

# 3. 보안을 위한 .gitignore 파일 작성
# inventory.ini와 키 파일이 GitHub에 업로드되는 것을 방지합니다.
# EOT: End of Text(Typing) 
cat <<EOT > .gitignore #버전 관리 안하겠다
inventory.ini #보내면 안됨
*.pem #키
*.key #키
.vault_pass #이런건 신경쓰지 말아라
EOT

# 4. 설정 반영
# 자기 관리 (자기 안에서 버전 관리)
git add .gitignore
git commit -m "Initial commit: Set project environment and security"

```

---

## 3. [내 PC → 대상 서버] SSH 신뢰 관계 구축

Ansible이 비밀번호 입력 없이 10대의 서버에 동시 접속할 수 있도록 공개 키를 배포합니다. 이 작업은 **내 PC**에서 수행합니다.

```bash
# 1. SSH 키 쌍 생성 (기존 키가 없을 경우에만 실행)
ssh-keygen -t rsa -b 4096 -f ~/.ssh/my-key.pem -N "" #자기꺼 넣어야 함

# 2. 대상 서버(101~110번)로 공개 키 전송
# 최초 1회는 서버의 로그인 비밀번호를 입력해야 합니다.
for i in {101..110}; do
  ssh-copy-id -i ~/.ssh/my-key.pem.pub ubuntu@192.168.10.$i
done

```
####설명 예시1
```
$for i in {1..10};do
> echo"hello $i">>imsi
> done
# ls로 imsi 파일을 확인하고
# cat imsi로 안에 1부터 10까지 올라간 것 확인
```
---

## 4. [내 PC] Ansible 구성 파일 작성

서버 리스트와 배포 시나리오를 정의합니다. `inventory.ini`는 `.gitignore`에 등록되어 있으므로 안심하고 작성합니다.

### 인벤토리 파일 (`inventory.ini`)

```ini
[webservers] #주석 아니고 그룹명임 (앞으로 웹서버가 몇 대가 될 지 몰라서)
# 101번부터 110번 서버까지 한 번에 정의 #예제로 101부터 110번 든 거니까 자기 짝꿍 것 만 하면 됨
web-node-[101:110] ansible_host=192.168.10.{{ item }} # :는 ~와 같은 표현 파이썬에서도 이렇게 표현 함 #엔서블이 파이썬으로 만든 것이라서
# {{}}는 변수를 표현하는 jinja2의 형식 3가지 중에 하나. # , $: if, for같은 제어문을 넣을 수 있음
# ansible_host가 또 하나의 변수 역할을 함

[webservers:vars]
ansible_user=ubuntu #우리는 옆짝꿍꺼 (master로 해야 함)
ansible_ssh_private_key_file=~/.ssh/my-key.pem # ~/.ssh/my-key.pem도 자기꺼 넣어서 바꿔야 함

```

### 플레이북 파일 (`deploy.yml`) 야물로 된 걸 플레이북이라고 부름
배포니까 설치가 들어가있음

```yaml
#---로 시작하는 형식 기억 중요 -^0
# 두 칸 뛰어야 함 중요 -^0
# .profile vim ic에 넣어준 세로선 확인
---
- name: web_dep 자동 배포 플레이북
  hosts: webservers #위에서 쓴 서버 그룹명 그대로 똑같이 써야 함
  become: true #become은 sudo를 쓸 거냐 아니냐 #apt는 root유저로 써야 함 (개인은 권한 때문에 안 될 수도 있음)
  vars:
    # 본인의 GitHub 저장소 주소로 변경
    git_repo_url: "https://github.com/사용자계정/web_dep.git" #깃리퍼지토리에서 가져오겠다는 것 #web_dep이 자기 디렉토리 가져오라는 것
    web_root: "/var/www/html" #바꿀 수 있음 실무에서 대부분 여기에 저장 안 함
#root영역이라 sudo로 가져와야 함
#개발자들이 root영역 잘 못 들어오게 함 :root영역 들어왔다는 로그도 계속 쌓이기 때문

  #해야 할 작업들
  # ta 앞에 두 칸 있는지 확인
  tasks:
    - name: Nginx 웹 서버 설치
      #엔서블의 명령어라고 생각하면 됨 (ansible apt라고 생각하면 됨)
      #모듈 옵션이기 때문에 빈 칸 생략하면 안 됨
      #아래의 nate,state,update_cache도 비어있으면 빼도 됨 : 디폴트로 감, (지금은 아래가 안비어서 위에 apt생략 불가)
      apt:
        name: nginx
        state: present
        update_cache: yes

    - name: GitHub 저장소에서 최신 소스 코드 배포
      git:
        repo: "{{ git_repo_url }}" #repository의 약자 {{git_repo_url}}은 변수값 위에 있는 내 주소 찾아 올 수 있음
        dest: "{{ web_root }}" #위에서 어디를 향하는지 찾아보기 중요 !숙제! -^hw=위의 web_root
        version: main #main 브랜치 
        force: yes

    - name: Nginx 서비스 활성화 및 시작
      service:
        name: nginx
        state: started #항상 유지하라
        enabled: true #서버가 죽었다 켜도 다시 start해라

```

---

## 5. [내 PC ↔ GitHub] 소스 배포 및 자동화 실행

### 단계 1: 웹 소스 작성 및 GitHub 푸시

```bash
# 배포할 웹 소스=html 생성
# html 안에 들어갈 내용들 = 웹브라우저에 보일 내용들을 웹소스라고 부름
echo "<h1>Welcome to web_dep Project</h1>" > index.html  #</h1>없어도 html은 가능함

# GitHub 원격 저장소 연결 (GitHub에서 미리 web_dep 리포지토리를 생성해야 함)
git remote add origin https://github.com/사용자계정/web_dep.git

# 코드 업로드 (inventory.ini는 자동 제외됨)
git add index.html deploy.yml #deploy.yml 위에서 만든 플레이북
git commit -m "Add web content and deployment playbook"
# git pull 한번 여기서 해주면 좋음 근데 레퍼지토리 한번 싹 비우고 시작해야 함 (지금 실습으로 너무 더러워짐)
git push -u origin main

```

### 단계 2: [내 PC] Ansible 실행
위에서 만든 파일 깃허브에 올려두고 내 서버에도 하나 가지고 있기 (깃허브에서 수정작업하고 다 되면 다운로드하기 우리는)
내 PC에서 명령을 내려 10대의 서버가 GitHub의 최신 코드를 내려받도록 합니다.

```bash
ansible-playbook -i inventory.ini deploy.yml #이건 내 서버vm에서 작성

```

---

## 6. AWS 관련 비용 및 보안 주의사항

* **인스턴스 과금**: 실습 예제의 10대 서버를 모두 AWS EC2로 가동할 경우 **Free Tier 무료 제공량(750시간/월)을 매우 빠르게 소진**하게 됩니다. 10대를 띄우면 약 75시간(3일) 만에 한 달치 무료 시간이 끝납니다.
* **Security Group**: 대상 서버 인스턴스의 보안 그룹에서 **SSH(22)**와 **HTTP(80)** 포트가 본인 PC의 IP에 대해 허용되어 있는지 확인하세요.
* **자원 회수**: 실습 종료 후에는 반드시 모든 인스턴스를 **종료(Terminate)**하여 불필요한 과금을 방지해야 합니다.

---

Next Step: Ansible Vault를 이용한 inventory.ini 암호화 및 변수 관리 실습

---

Next Step: Ansible Vault 변수 암호화 활용하기
