###### ^^
SSH는 기본적으로 id_rsa 같은 익숙한 키부터 자동으로 시도한다.  
그래서 여러 키가 있으면 의도한 키가 안 쓰일 수 있다.  
이걸 피하려면 ed25519를 쓰고,  
접속할 때 -i 옵션으로 사용할 키를 명확히 지정하는 게 가장 확실하다.  
서버에는 접속을 허용할 공개키만 authorized_keys에 등록한다.  

ed25519: 요즘 표준, 가장 추천  

-f: 키 만들 때 파일 이름 지정  

-i: 접속할 때 쓸 키를 명확히 지정  

authorized_keys: 서버가 믿는 공개키 목록  

# Chapter 6. 커스텀 키 이름 사용 시 발생하는 'Identity' 오류와 해결

사용자의 지적은 정확하다. `ssh-keygen`으로 키를 생성할 때 `-f` 옵션으로 **기본 이름(id_rsa, id_ed25519 등)이 아닌 다른 이름(예: my_project_key)**을 지정했다면, 추가 설정 없이는 Git이나 SSH 접속 시 100% 확률로 **"Permission denied (publickey)"** 오류가 발생한다.

본 장에서는 왜 이러한 현상이 발생하는지(SSH의 기본 동작 원리)와 이를 해결하여 커스텀 키를 정상적으로 인식시키는 두 가지 표준 방법을 설명한다.

---

### 1. 오류 발생 원인: SSH 클라이언트의 '기본 탐색 경로'

SSH 클라이언트(Git이 내부적으로 사용하는 접속 도구)는 접속 시도 시 아무런 지시가 없으면 **약속된 기본 파일명**만을 순차적으로 탐색한다.

**SSH의 기본 탐색 순서:**

1. `~/.ssh/id_rsa`
2. `~/.ssh/id_ecdsa`
3. `~/.ssh/id_ed25519`
4. ... (기타 표준 알고리즘 키)

**문제 상황:**
사용자가 만든 `my_project_key`는 위 목록에 존재하지 않는다. 따라서 SSH 클라이언트는 "사용 가능한 키가 없다"고 판단하거나, 엉뚱한 기본 키(`id_rsa`)를 서버에 제출하게 되고, 서버는 "등록된 키와 다르다"며 접속을 거부한다.

---

### 2. 해결 방법 A: SSH Config 파일에 'IdentityFile' 명시 (가장 권장)

이 문제를 해결하는 가장 정석적인 방법은 SSH 설정 파일(`config`)을 통해 **"이 호스트에 접속할 때는 저 파일을 사용하라"**고 명시적으로 지정하는 것이다. 이는 영구적인 설정이므로 한 번만 등록하면 된다.

**설정 파일 경로:** `~/.ssh/config` 없으면 만들면 됨

**작성 예시:**

```ssh
# my-git-server라는 별칭을 만들고, 특정 키 파일을 지정
Host my-git-server
    HostName git.example.com # 아이피 쓰면 여기에 아이피 넣으면 됨
    User git   # 유저이름이 master 가 아니라 git
    IdentityFile ~/.ssh/my_project_key  <-- 핵심: 커스텀 키 경로를 직접 지정 (그 사람한테 보낼 공개 키)

```

**작동 원리:**
이제 사용자가 `git clone git@my-git-server:...` 명령을 내리면, SSH는 기본 탐색 순서를 무시하고 설정에 적힌 `~/.ssh/my_project_key`를 최우선으로 가져와 서버에 제출한다.

---

### 3. 해결 방법 B: SSH-Agent에 키 등록 (세션 단위 해결)

설정 파일을 건드리지 않고, 메모리에 상주하는 **SSH 에이전트(Key Agent)**에 커스텀 키를 미리 로드해두는 방법이다. 에이전트가 실행 중이라면, SSH 클라이언트는 파일 시스템을 뒤지기 전에 에이전트에게 "네가 가지고 있는 키가 있냐"고 먼저 물어본다.

**실행 순서:**

1. **에이전트 실행 (백그라운드):**
```bash
eval "$(ssh-agent -s)"

```


2. **커스텀 키를 에이전트에 추가:**
```bash
# ssh-add [커스텀 키 경로]
ssh-add ~/.ssh/my_project_key

```


3. **등록 확인:**
```bash
ssh-add -l
# 출력 결과에 my_project_key의 지문(fingerprint)이 보이면 성공

```



**특징:**

* 이 방법은 **재부팅하면 초기화**되므로, 매번 다시 등록하거나 셸 초기화 스크립트(.bashrc 등)에 등록 과정을 넣어야 하는 번거로움이 있다. 따라서 **해결 방법 A(Config 파일)**가 운영 관리 측면에서 훨씬 유리하다.

### 요약

커스텀 이름으로 키를 만들었다면, **"만들고 끝"이 아니라 반드시 "Config에 등록"**하는 단계가 한 세트로 이루어져야 한다.

Next Step:
Git Config(`core.sshCommand`)를 이용해 특정 리포지토리에서만 특정 키를 강제하는 방법
